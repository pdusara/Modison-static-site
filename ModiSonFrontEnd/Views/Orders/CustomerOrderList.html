<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Orders</title>
    <link rel="stylesheet" href="/static/wwwroot/css/styles.css"> <!-- Optional: Include a CSS file -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>
</head>

<body>
    <header>
        <nav>
            <a href="index.html">Home</a>
            <a href="order.html">Order Now</a>
            <a
                href="https://modison-auth-domain.auth.us-east-1.amazoncognito.com/login?client_id=50cr96cieb5opojbgbetrpdq5t&response_type=token&scope=openid+profile+email&redirect_uri=http://127.0.0.1:5500/static/Views/Home/index.html">Sign
                In</a>
            <a
                href="https://modison-auth-domain.auth.us-east-1.amazoncognito.com/logout?client_id=50cr96cieb5opojbgbetrpdq5t&logout_uri=https://localhost:7122">Sign
                Out</a>
        </nav>
    </header>
    <p id="username"></p>

    <h2>Your Orders</h2>
    <table id="ordersTable">
        <tr>
            <th>Snack</th>
            <th>Quantity</th>
            <th>Order Date</th>
            <th>Order Status</th>
        </tr>
    </table>
    <p id="noOrders" style="display: none;">No orders placed yet.</p>

    <script>
        let authToken = null; // Cognito authentication token

        async function fetchOrders() {
            if (!authToken) {
                console.error("User not authenticated.");
                return;
            }

            try {
                const response = await fetch("https://your-api-gateway-url/orders", {
                    headers: { "Authorization": authToken }
                });

                const orders = await response.json();
                const ordersTable = document.getElementById("ordersTable");

                if (orders.length === 0) {
                    document.getElementById("noOrders").style.display = "block";
                    return;
                }

                orders.forEach(order => {
                    order.Items.forEach(item => {
                        let row = document.createElement("tr");

                        row.innerHTML = `
                            <td>${item.ProductName}</td>
                            <td>${item.Quantity}</td>
                            <td>${new Date(order.OrderDate).toLocaleString()}</td>
                            <td>${order.Status}</td>
                        `;

                        ordersTable.appendChild(row);
                    });
                });
            } catch (error) {
                console.error("Error fetching orders:", error);
            }
        }

        function login() {
            const clientId = "50cr96cieb5opojbgbetrpdq5t";
            const redirectUri = "http://127.0.0.1:5500/static/Views/Home/index.html";
            const loginUrl = `https://modison-auth-domain.auth.us-east-1.amazoncognito.com/oauth2/authorize?client_id=${clientId}&response_type=token&scope=openid+email+profile&redirect_uri=${redirectUri}`;
            window.location.href = loginUrl;
        }

        function handleAuthRedirect() {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            authToken = params.get("id_token");

            if (authToken) {
                fetchOrders();
            }
        }

        window.onload = handleAuthRedirect;
    </script>
</body>

</html>